"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const keepa_client_1 = require("../src/keepa-client");
const types_1 = require("../src/types");
describe('KeepaClient', () => {
    let client;
    beforeEach(() => {
        client = new keepa_client_1.KeepaClient({ apiKey: 'test-api-key' });
    });
    describe('getSellerCount', () => {
        const mockProduct = {
            stats: {
                current: new Array(34).fill(0),
                avg30: new Array(34).fill(0),
                avg90: new Array(34).fill(0),
                avg180: new Array(34).fill(0),
                avg365: new Array(34).fill(0)
            }
        };
        beforeEach(() => {
            // Set seller count values for testing (DataType.COUNT_NEW = index 11)
            mockProduct.stats.current[11] = 9; // Current: 9 sellers
            mockProduct.stats.avg30[11] = 7; // 30-day avg: 7 sellers
            mockProduct.stats.avg90[11] = 5; // 90-day avg: 5 sellers
            mockProduct.stats.avg180[11] = 4; // 180-day avg: 4 sellers
            mockProduct.stats.avg365[11] = 3; // 365-day avg: 3 sellers
        });
        it('should return current seller count', () => {
            const result = client.getSellerCount(mockProduct, 'current');
            expect(result.count).toBe(9);
            expect(result.description).toBe('current');
        });
        it('should return 30-day average seller count', () => {
            const result = client.getSellerCount(mockProduct, '30day');
            expect(result.count).toBe(7);
            expect(result.description).toBe('30-day average');
        });
        it('should return 90-day average seller count (default)', () => {
            const result = client.getSellerCount(mockProduct, '90day');
            expect(result.count).toBe(5);
            expect(result.description).toBe('90-day average');
        });
        it('should return 180-day average seller count', () => {
            const result = client.getSellerCount(mockProduct, '180day');
            expect(result.count).toBe(4);
            expect(result.description).toBe('180-day average');
        });
        it('should return 365-day average seller count', () => {
            const result = client.getSellerCount(mockProduct, '365day');
            expect(result.count).toBe(3);
            expect(result.description).toBe('365-day average');
        });
        it('should default to 90-day average when no timeframe specified', () => {
            const result = client.getSellerCount(mockProduct);
            expect(result.count).toBe(5);
            expect(result.description).toBe('90-day average');
        });
        it('should default to 90-day average for invalid timeframe', () => {
            const result = client.getSellerCount(mockProduct, 'invalid');
            expect(result.count).toBe(5);
            expect(result.description).toBe('90-day average (default)');
        });
        it('should return count 1 when product has no stats', () => {
            const productWithoutStats = { asin: 'B123456789' };
            const result = client.getSellerCount(productWithoutStats);
            expect(result.count).toBe(1);
            expect(result.description).toBe('90-day average (no stats available)');
        });
        it('should return count 1 when stats array is undefined', () => {
            const productWithUndefinedStats = {
                stats: {
                // avg90 is undefined
                }
            };
            const result = client.getSellerCount(productWithUndefinedStats, '90day');
            expect(result.count).toBe(1);
            expect(result.description).toBe('90-day average');
        });
        it('should handle zero seller count correctly', () => {
            // Test that 0 is not treated as falsy
            mockProduct.stats.current[11] = 0;
            const result = client.getSellerCount(mockProduct, 'current');
            expect(result.count).toBe(0);
            expect(result.description).toBe('current');
        });
    });
    describe('formatPrice', () => {
        it('should format US prices correctly', () => {
            const price = client.formatPrice(4999, types_1.KeepaDomain.US);
            expect(price).toBe('$49.99');
        });
        it('should format UK prices correctly', () => {
            const price = client.formatPrice(2549, types_1.KeepaDomain.UK);
            expect(price).toBe('Â£25.49');
        });
        it('should format zero price correctly', () => {
            const price = client.formatPrice(0, types_1.KeepaDomain.US);
            expect(price).toBe('$0.00');
        });
    });
    describe('getDomainName', () => {
        it('should return correct domain names', () => {
            expect(client.getDomainName(types_1.KeepaDomain.US)).toBe('amazon.com');
            expect(client.getDomainName(types_1.KeepaDomain.UK)).toBe('amazon.co.uk');
            expect(client.getDomainName(types_1.KeepaDomain.DE)).toBe('amazon.de');
        });
        it('should default to amazon.com for invalid domain', () => {
            expect(client.getDomainName(999)).toBe('amazon.com');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2VlcGEtY2xpZW50LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJrZWVwYS1jbGllbnQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNEQUFrRDtBQUNsRCx3Q0FBMkM7QUFFM0MsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsSUFBSSxNQUFtQixDQUFDO0lBRXhCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxNQUFNLEdBQUcsSUFBSSwwQkFBVyxDQUFDLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7SUFDdkQsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLE1BQU0sV0FBVyxHQUFHO1lBQ2xCLEtBQUssRUFBRTtnQkFDTCxPQUFPLEVBQUUsSUFBSSxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDOUIsS0FBSyxFQUFFLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLEtBQUssRUFBRSxJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUM1QixNQUFNLEVBQUUsSUFBSSxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDN0IsTUFBTSxFQUFFLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDOUI7U0FDRixDQUFDO1FBRUYsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLHNFQUFzRTtZQUN0RSxXQUFXLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBSSxxQkFBcUI7WUFDM0QsV0FBVyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcs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QyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzdCLEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7WUFDNUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsbUJBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNoRSxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxtQkFBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ2xFLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLG1CQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDakUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaURBQWlELEVBQUUsR0FBRyxFQUFFO1lBQ3pELE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEtlZXBhQ2xpZW50IH0gZnJvbSAnLi4vc3JjL2tlZXBhLWNsaWVudCc7XG5pbXBvcnQgeyBLZWVwYURvbWFpbiB9IGZyb20gJy4uL3NyYy90eXBlcyc7XG5cbmRlc2NyaWJlKCdLZWVwYUNsaWVudCcsICgpID0+IHtcbiAgbGV0IGNsaWVudDogS2VlcGFDbGllbnQ7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgY2xpZW50ID0gbmV3IEtlZXBhQ2xpZW50KHsgYXBpS2V5OiAndGVzdC1hcGkta2V5JyB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFNlbGxlckNvdW50JywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tQcm9kdWN0ID0ge1xuICAgICAgc3RhdHM6IHtcbiAgICAgICAgY3VycmVudDogbmV3IEFycmF5KDM0KS5maWxsKDApLFxuICAgICAgICBhdmczMDogbmV3IEFycmF5KDM0KS5maWxsKDApLFxuICAgICAgICBhdmc5MDogbmV3IEFycmF5KDM0KS5maWxsKDApLFxuICAgICAgICBhdmcxODA6IG5ldyBBcnJheSgzNCkuZmlsbCgwKSxcbiAgICAgICAgYXZnMzY1OiBuZXcgQXJyYXkoMzQpLmZpbGwoMClcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAvLyBTZXQgc2VsbGVyIGNvdW50IHZhbHVlcyBmb3IgdGVzdGluZyAoRGF0YVR5cGUuQ09VTlRfTkVXID0gaW5kZXggMTEpXG4gICAgICBtb2NrUHJvZHVjdC5zdGF0cy5jdXJyZW50WzExXSA9IDk7ICAgIC8vIEN1cnJlbnQ6IDkgc2VsbGVyc1xuICAgICAgbW9ja1Byb2R1Y3Quc3RhdHMuYXZnMzBbMTFdID0gNzsgICAgICAvLyAzMC1kYXkgYXZnOiA3IHNlbGxlcnNcbiAgICAgIG1vY2tQcm9kdWN0LnN0YXRzLmF2ZzkwWzExXSA9IDU7ICAgICAgLy8gOTAtZGF5IGF2ZzogNSBzZWxsZXJzXG4gICAgICBtb2NrUHJvZHVjdC5zdGF0cy5hdmcxODBbMTFdID0gNDsgICAgIC8vIDE4MC1kYXkgYXZnOiA0IHNlbGxlcnNcbiAgICAgIG1vY2tQcm9kdWN0LnN0YXRzLmF2ZzM2NVsxMV0gPSAzOyAgICAgLy8gMzY1LWRheSBhdmc6IDMgc2VsbGVyc1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY3VycmVudCBzZWxsZXIgY291bnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjbGllbnQuZ2V0U2VsbGVyQ291bnQobW9ja1Byb2R1Y3QsICdjdXJyZW50Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuY291bnQpLnRvQmUoOSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS50b0JlKCdjdXJyZW50Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiAzMC1kYXkgYXZlcmFnZSBzZWxsZXIgY291bnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjbGllbnQuZ2V0U2VsbGVyQ291bnQobW9ja1Byb2R1Y3QsICczMGRheScpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LmNvdW50KS50b0JlKDcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikudG9CZSgnMzAtZGF5IGF2ZXJhZ2UnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDkwLWRheSBhdmVyYWdlIHNlbGxlciBjb3VudCAoZGVmYXVsdCknLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjbGllbnQuZ2V0U2VsbGVyQ291bnQobW9ja1Byb2R1Y3QsICc5MGRheScpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LmNvdW50KS50b0JlKDUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikudG9CZSgnOTAtZGF5IGF2ZXJhZ2UnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDE4MC1kYXkgYXZlcmFnZSBzZWxsZXIgY291bnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjbGllbnQuZ2V0U2VsbGVyQ291bnQobW9ja1Byb2R1Y3QsICcxODBkYXknKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5jb3VudCkudG9CZSg0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb24pLnRvQmUoJzE4MC1kYXkgYXZlcmFnZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gMzY1LWRheSBhdmVyYWdlIHNlbGxlciBjb3VudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNsaWVudC5nZXRTZWxsZXJDb3VudChtb2NrUHJvZHVjdCwgJzM2NWRheScpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LmNvdW50KS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikudG9CZSgnMzY1LWRheSBhdmVyYWdlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlZmF1bHQgdG8gOTAtZGF5IGF2ZXJhZ2Ugd2hlbiBubyB0aW1lZnJhbWUgc3BlY2lmaWVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gY2xpZW50LmdldFNlbGxlckNvdW50KG1vY2tQcm9kdWN0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5jb3VudCkudG9CZSg1KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb24pLnRvQmUoJzkwLWRheSBhdmVyYWdlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlZmF1bHQgdG8gOTAtZGF5IGF2ZXJhZ2UgZm9yIGludmFsaWQgdGltZWZyYW1lJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gY2xpZW50LmdldFNlbGxlckNvdW50KG1vY2tQcm9kdWN0LCAnaW52YWxpZCcgYXMgYW55KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5jb3VudCkudG9CZSg1KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb24pLnRvQmUoJzkwLWRheSBhdmVyYWdlIChkZWZhdWx0KScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY291bnQgMSB3aGVuIHByb2R1Y3QgaGFzIG5vIHN0YXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdFdpdGhvdXRTdGF0cyA9IHsgYXNpbjogJ0IxMjM0NTY3ODknIH07XG4gICAgICBjb25zdCByZXN1bHQgPSBjbGllbnQuZ2V0U2VsbGVyQ291bnQocHJvZHVjdFdpdGhvdXRTdGF0cyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuY291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS50b0JlKCc5MC1kYXkgYXZlcmFnZSAobm8gc3RhdHMgYXZhaWxhYmxlKScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY291bnQgMSB3aGVuIHN0YXRzIGFycmF5IGlzIHVuZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2R1Y3RXaXRoVW5kZWZpbmVkU3RhdHMgPSB7XG4gICAgICAgIHN0YXRzOiB7XG4gICAgICAgICAgLy8gYXZnOTAgaXMgdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBjb25zdCByZXN1bHQgPSBjbGllbnQuZ2V0U2VsbGVyQ291bnQocHJvZHVjdFdpdGhVbmRlZmluZWRTdGF0cywgJzkwZGF5Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuY291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS50b0JlKCc5MC1kYXkgYXZlcmFnZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgemVybyBzZWxsZXIgY291bnQgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IDAgaXMgbm90IHRyZWF0ZWQgYXMgZmFsc3lcbiAgICAgIG1vY2tQcm9kdWN0LnN0YXRzLmN1cnJlbnRbMTFdID0gMDtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNsaWVudC5nZXRTZWxsZXJDb3VudChtb2NrUHJvZHVjdCwgJ2N1cnJlbnQnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5jb3VudCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb24pLnRvQmUoJ2N1cnJlbnQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Zvcm1hdFByaWNlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZm9ybWF0IFVTIHByaWNlcyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcmljZSA9IGNsaWVudC5mb3JtYXRQcmljZSg0OTk5LCBLZWVwYURvbWFpbi5VUyk7XG4gICAgICBleHBlY3QocHJpY2UpLnRvQmUoJyQ0OS45OScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmb3JtYXQgVUsgcHJpY2VzIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNvbnN0IHByaWNlID0gY2xpZW50LmZvcm1hdFByaWNlKDI1NDksIEtlZXBhRG9tYWluLlVLKTtcbiAgICAgIGV4cGVjdChwcmljZSkudG9CZSgnwqMyNS40OScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmb3JtYXQgemVybyBwcmljZSBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcmljZSA9IGNsaWVudC5mb3JtYXRQcmljZSgwLCBLZWVwYURvbWFpbi5VUyk7XG4gICAgICBleHBlY3QocHJpY2UpLnRvQmUoJyQwLjAwJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXREb21haW5OYW1lJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgZG9tYWluIG5hbWVzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNsaWVudC5nZXREb21haW5OYW1lKEtlZXBhRG9tYWluLlVTKSkudG9CZSgnYW1hem9uLmNvbScpO1xuICAgICAgZXhwZWN0KGNsaWVudC5nZXREb21haW5OYW1lKEtlZXBhRG9tYWluLlVLKSkudG9CZSgnYW1hem9uLmNvLnVrJyk7XG4gICAgICBleHBlY3QoY2xpZW50LmdldERvbWFpbk5hbWUoS2VlcGFEb21haW4uREUpKS50b0JlKCdhbWF6b24uZGUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVmYXVsdCB0byBhbWF6b24uY29tIGZvciBpbnZhbGlkIGRvbWFpbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChjbGllbnQuZ2V0RG9tYWluTmFtZSg5OTkgYXMgYW55KSkudG9CZSgnYW1hem9uLmNvbScpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==