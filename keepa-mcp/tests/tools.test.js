"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tools_1 = require("../src/tools");
describe('Tool Schemas', () => {
    describe('ProductFinderSchema', () => {
        it('should validate with default sellerCountTimeframe', () => {
            const validInput = {
                domain: 1,
                categoryId: 493964,
                minRating: 4.0,
                minSellerCount: 4,
                maxSellerCount: 8
            };
            const result = tools_1.ProductFinderSchema.parse(validInput);
            expect(result.sellerCountTimeframe).toBe('90day'); // Default value
            expect(result.domain).toBe(1);
            expect(result.categoryId).toBe(493964);
        });
        it('should accept all valid sellerCountTimeframe values', () => {
            const timeframes = ['current', '30day', '90day', '180day', '365day'];
            timeframes.forEach(timeframe => {
                const input = {
                    domain: 1,
                    sellerCountTimeframe: timeframe
                };
                const result = tools_1.ProductFinderSchema.parse(input);
                expect(result.sellerCountTimeframe).toBe(timeframe);
            });
        });
        it('should reject invalid sellerCountTimeframe values', () => {
            const invalidInput = {
                domain: 1,
                sellerCountTimeframe: 'invalid'
            };
            expect(() => tools_1.ProductFinderSchema.parse(invalidInput)).toThrow();
        });
        it('should validate complete ProductFinder input', () => {
            const completeInput = {
                domain: 1,
                categoryId: 493964,
                minRating: 4.4,
                maxRating: 5.0,
                minPrice: 1000,
                maxPrice: 5000,
                minSellerCount: 4,
                maxSellerCount: 8,
                sellerCountTimeframe: 'current',
                minMonthlySales: 1000,
                isPrime: true,
                hasReviews: true,
                sortBy: 'monthlySold',
                sortOrder: 'desc',
                perPage: 10
            };
            const result = tools_1.ProductFinderSchema.parse(completeInput);
            expect(result).toMatchObject(completeInput);
            expect(result.sellerCountTimeframe).toBe('current');
        });
    });
    describe('CategoryAnalysisSchema', () => {
        it('should validate with default sellerCountTimeframe', () => {
            const validInput = {
                domain: 1,
                categoryId: 493964,
                analysisType: 'overview'
            };
            const result = tools_1.CategoryAnalysisSchema.parse(validInput);
            expect(result.sellerCountTimeframe).toBe('90day');
            expect(result.analysisType).toBe('overview');
        });
        it('should accept custom sellerCountTimeframe', () => {
            const input = {
                domain: 1,
                categoryId: 493964,
                analysisType: 'opportunities',
                sellerCountTimeframe: '30day'
            };
            const result = tools_1.CategoryAnalysisSchema.parse(input);
            expect(result.sellerCountTimeframe).toBe('30day');
        });
    });
    describe('SalesVelocitySchema', () => {
        it('should validate with default sellerCountTimeframe', () => {
            const validInput = {
                domain: 1,
                asins: ['B08412MCNW', 'B0DCV47JXX']
            };
            const result = tools_1.SalesVelocitySchema.parse(validInput);
            expect(result.sellerCountTimeframe).toBe('90day');
            expect(result.asins).toEqual(['B08412MCNW', 'B0DCV47JXX']);
        });
        it('should accept custom sellerCountTimeframe', () => {
            const input = {
                domain: 1,
                categoryId: 493964,
                sellerCountTimeframe: '365day',
                minVelocity: 10
            };
            const result = tools_1.SalesVelocitySchema.parse(input);
            expect(result.sellerCountTimeframe).toBe('365day');
        });
    });
    describe('InventoryAnalysisSchema', () => {
        it('should validate with default sellerCountTimeframe', () => {
            const validInput = {
                domain: 1,
                asins: ['B08412MCNW'],
                analysisType: 'overview'
            };
            const result = tools_1.InventoryAnalysisSchema.parse(validInput);
            expect(result.sellerCountTimeframe).toBe('90day');
            expect(result.targetTurnoverRate).toBe(12); // Default
        });
        it('should accept custom parameters', () => {
            const input = {
                domain: 1,
                categoryId: 493964,
                analysisType: 'fast_movers',
                sellerCountTimeframe: '180day',
                targetTurnoverRate: 24,
                timeframe: 'quarter'
            };
            const result = tools_1.InventoryAnalysisSchema.parse(input);
            expect(result.sellerCountTimeframe).toBe('180day');
            expect(result.targetTurnoverRate).toBe(24);
            expect(result.timeframe).toBe('quarter');
        });
    });
    describe('Schema Integration', () => {
        it('should ensure all schemas have consistent sellerCountTimeframe options', () => {
            const expectedOptions = ['current', '30day', '90day', '180day', '365day'];
            // Test that all schemas accept the same timeframe options
            expectedOptions.forEach(timeframe => {
                expect(() => tools_1.ProductFinderSchema.parse({
                    domain: 1,
                    sellerCountTimeframe: timeframe
                })).not.toThrow();
                expect(() => tools_1.CategoryAnalysisSchema.parse({
                    domain: 1,
                    categoryId: 123,
                    sellerCountTimeframe: timeframe
                })).not.toThrow();
                expect(() => tools_1.SalesVelocitySchema.parse({
                    domain: 1,
                    sellerCountTimeframe: timeframe
                })).not.toThrow();
                expect(() => tools_1.InventoryAnalysisSchema.parse({
                    domain: 1,
                    sellerCountTimeframe: timeframe
                })).not.toThrow();
            });
        });
        it('should reject invalid timeframes consistently across all schemas', () => {
            const invalidTimeframe = 'weekly';
            expect(() => tools_1.ProductFinderSchema.parse({
                domain: 1,
                sellerCountTimeframe: invalidTimeframe
            })).toThrow();
            expect(() => tools_1.CategoryAnalysisSchema.parse({
                domain: 1,
                categoryId: 123,
                sellerCountTimeframe: invalidTimeframe
            })).toThrow();
            expect(() => tools_1.SalesVelocitySchema.parse({
                domain: 1,
                sellerCountTimeframe: invalidTimeframe
            })).toThrow();
            expect(() => tools_1.InventoryAnalysisSchema.parse({
                domain: 1,
                sellerCountTimeframe: invalidTimeframe
            })).toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRvb2xzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FLc0I7QUFFdEIsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDNUIsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxFQUFFLENBQUMsbURBQW1ELEVBQUUsR0FBRyxFQUFFO1lBQzNELE1BQU0sVUFBVSxHQUFHO2dCQUNqQixNQUFNLEVBQUUsQ0FBQztnQkFDVCxVQUFVLEVBQUUsTUFBTTtnQkFDbEIsU0FBUyxFQUFFLEdBQUc7Z0JBQ2QsY0FBYyxFQUFFLENBQUM7Z0JBQ2pCLGNBQWMsRUFBRSxDQUFDO2FBQ2xCLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRywyQkFBbUIsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFckQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGdCQUFnQjtZQUNuRSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxREFBcUQsRUFBRSxHQUFHLEVBQUU7WUFDN0QsTUFBTSxVQUFVLEdBQUcsQ0FBQyxTQUFTLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFVLENBQUM7WUFFOUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRTtnQkFDN0IsTUFBTSxLQUFLLEdBQUc7b0JBQ1osTUFBTSxFQUFFLENBQUM7b0JBQ1Qsb0JBQW9CLEVBQUUsU0FBUztpQkFDaEMsQ0FBQztnQkFF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RUFBRSxHQUFHO2dCQUNmLG9CQUFvQixFQUFFLGdCQUFnQjthQUN2QyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUVkLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQywyQkFBbUIsQ0FBQyxLQUFLLENBQUM7Z0JBQ3JDLE1BQU0sRUFBRSxDQUFDO2dCQUNULG9CQUFvQixFQUFFLGdCQUFnQjthQUN2QyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUVkLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQywrQkFBdUIsQ0FBQyxLQUFLLENBQUM7Z0JBQ3pDLE1BQU0sRUFBRSxDQUFDO2dCQUNULG9CQUFvQixFQUFFLGdCQUFnQjthQUN2QyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNoQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBcbiAgUHJvZHVjdEZpbmRlclNjaGVtYSwgXG4gIENhdGVnb3J5QW5hbHlzaXNTY2hlbWEsIFxuICBTYWxlc1ZlbG9jaXR5U2NoZW1hLFxuICBJbnZlbnRvcnlBbmFseXNpc1NjaGVtYSBcbn0gZnJvbSAnLi4vc3JjL3Rvb2xzJztcblxuZGVzY3JpYmUoJ1Rvb2wgU2NoZW1hcycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ1Byb2R1Y3RGaW5kZXJTY2hlbWEnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB3aXRoIGRlZmF1bHQgc2VsbGVyQ291bnRUaW1lZnJhbWUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZElucHV0ID0ge1xuICAgICAgICBkb21haW46IDEsXG4gICAgICAgIGNhdGVnb3J5SWQ6IDQ5Mzk2NCxcbiAgICAgICAgbWluUmF0aW5nOiA0LjAsXG4gICAgICAgIG1pblNlbGxlckNvdW50OiA0LFxuICAgICAgICBtYXhTZWxsZXJDb3VudDogOFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gUHJvZHVjdEZpbmRlclNjaGVtYS5wYXJzZSh2YWxpZElucHV0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zZWxsZXJDb3VudFRpbWVmcmFtZSkudG9CZSgnOTBkYXknKTsgLy8gRGVmYXVsdCB2YWx1ZVxuICAgICAgZXhwZWN0KHJlc3VsdC5kb21haW4pLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNhdGVnb3J5SWQpLnRvQmUoNDkzOTY0KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWNjZXB0IGFsbCB2YWxpZCBzZWxsZXJDb3VudFRpbWVmcmFtZSB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0aW1lZnJhbWVzID0gWydjdXJyZW50JywgJzMwZGF5JywgJzkwZGF5JywgJzE4MGRheScsICczNjVkYXknXSBhcyBjb25zdDtcbiAgICAgIFxuICAgICAgdGltZWZyYW1lcy5mb3JFYWNoKHRpbWVmcmFtZSA9PiB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0ge1xuICAgICAgICAgIGRvbWFpbjogMSxcbiAgICAgICAgICBzZWxsZXJDb3VudFRpbWVmcmFtZTogdGltZWZyYW1lXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXN1bHQgPSBQcm9kdWN0RmluZGVyU2NoZW1hLnBhcnNlKGlucHV0KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zZWxsZXJDb3VudFRpbWVmcmFtZSkudG9CZSh0aW1lZnJhbWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIHNlbGxlckNvdW50VGltZWZyYW1lIHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRJbnB1dCA9IHtcbiAgICAgICAgZG9tYWluOiAxLFxuICAgICAgICBzZWxsZXJDb3VudFRpbWVmcmFtZTogJ2ludmFsaWQnXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoKCkgPT4gUHJvZHVjdEZpbmRlclNjaGVtYS5wYXJzZShpbnZhbGlkSW5wdXQpKS50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGNvbXBsZXRlIFByb2R1Y3RGaW5kZXIgaW5wdXQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV0ZUlucHV0ID0ge1xuICAgICAgICBkb21haW46IDEsXG4gICAgICAgIGNhdGVnb3J5SWQ6IDQ5Mzk2NCxcbiAgICAgICAgbWluUmF0aW5nOiA0LjQsXG4gICAgICAgIG1heFJhdGluZzogNS4wLFxuICAgICAgICBtaW5QcmljZTogMTAwMCxcbiAgICAgICAgbWF4UHJpY2U6IDUwMDAsXG4gICAgICAgIG1pblNlbGxlckNvdW50OiA0LFxuICAgICAgICBtYXhTZWxsZXJDb3VudDogOCxcbiAgICAgICAgc2VsbGVyQ291bnRUaW1lZnJhbWU6ICdjdXJyZW50JyBhcyBjb25zdCxcbiAgICAgICAgbWluTW9udGhseVNhbGVzOiAxMDAwLFxuICAgICAgICBpc1ByaW1lOiB0cnVlLFxuICAgICAgICBoYXNSZXZpZXdzOiB0cnVlLFxuICAgICAgICBzb3J0Qnk6ICdtb250aGx5U29sZCcgYXMgY29uc3QsXG4gICAgICAgIHNvcnRPcmRlcjogJ2Rlc2MnIGFzIGNvbnN0LFxuICAgICAgICBwZXJQYWdlOiAxMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gUHJvZHVjdEZpbmRlclNjaGVtYS5wYXJzZShjb21wbGV0ZUlucHV0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9NYXRjaE9iamVjdChjb21wbGV0ZUlucHV0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2VsbGVyQ291bnRUaW1lZnJhbWUpLnRvQmUoJ2N1cnJlbnQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NhdGVnb3J5QW5hbHlzaXNTY2hlbWEnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB3aXRoIGRlZmF1bHQgc2VsbGVyQ291bnRUaW1lZnJhbWUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZElucHV0ID0ge1xuICAgICAgICBkb21haW46IDEsXG4gICAgICAgIGNhdGVnb3J5SWQ6IDQ5Mzk2NCxcbiAgICAgICAgYW5hbHlzaXNUeXBlOiAnb3ZlcnZpZXcnIGFzIGNvbnN0XG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBDYXRlZ29yeUFuYWx5c2lzU2NoZW1hLnBhcnNlKHZhbGlkSW5wdXQpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnNlbGxlckNvdW50VGltZWZyYW1lKS50b0JlKCc5MGRheScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hbmFseXNpc1R5cGUpLnRvQmUoJ292ZXJ2aWV3Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBjdXN0b20gc2VsbGVyQ291bnRUaW1lZnJhbWUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnB1dCA9IHtcbiAgICAgICAgZG9tYWluOiAxLFxuICAgICAgICBjYXRlZ29yeUlkOiA0OTM5NjQsXG4gICAgICAgIGFuYWx5c2lzVHlwZTogJ29wcG9ydHVuaXRpZXMnIGFzIGNvbnN0LFxuICAgICAgICBzZWxsZXJDb3VudFRpbWVmcmFtZTogJzMwZGF5JyBhcyBjb25zdFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gQ2F0ZWdvcnlBbmFseXNpc1NjaGVtYS5wYXJzZShpbnB1dCk7XG4gICAgICBleHBlY3QocmVzdWx0LnNlbGxlckNvdW50VGltZWZyYW1lKS50b0JlKCczMGRheScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2FsZXNWZWxvY2l0eVNjaGVtYScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHdpdGggZGVmYXVsdCBzZWxsZXJDb3VudFRpbWVmcmFtZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkSW5wdXQgPSB7XG4gICAgICAgIGRvbWFpbjogMSxcbiAgICAgICAgYXNpbnM6IFsnQjA4NDEyTUNOVycsICdCMERDVjQ3SlhYJ11cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IFNhbGVzVmVsb2NpdHlTY2hlbWEucGFyc2UodmFsaWRJbnB1dCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc2VsbGVyQ291bnRUaW1lZnJhbWUpLnRvQmUoJzkwZGF5Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LmFzaW5zKS50b0VxdWFsKFsnQjA4NDEyTUNOVycsICdCMERDVjQ3SlhYJ10pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgY3VzdG9tIHNlbGxlckNvdW50VGltZWZyYW1lJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5wdXQgPSB7XG4gICAgICAgIGRvbWFpbjogMSxcbiAgICAgICAgY2F0ZWdvcnlJZDogNDkzOTY0LFxuICAgICAgICBzZWxsZXJDb3VudFRpbWVmcmFtZTogJzM2NWRheScgYXMgY29uc3QsXG4gICAgICAgIG1pblZlbG9jaXR5OiAxMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gU2FsZXNWZWxvY2l0eVNjaGVtYS5wYXJzZShpbnB1dCk7XG4gICAgICBleHBlY3QocmVzdWx0LnNlbGxlckNvdW50VGltZWZyYW1lKS50b0JlKCczNjVkYXknKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludmVudG9yeUFuYWx5c2lzU2NoZW1hJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgd2l0aCBkZWZhdWx0IHNlbGxlckNvdW50VGltZWZyYW1lJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRJbnB1dCA9IHtcbiAgICAgICAgZG9tYWluOiAxLFxuICAgICAgICBhc2luczogWydCMDg0MTJNQ05XJ10sXG4gICAgICAgIGFuYWx5c2lzVHlwZTogJ292ZXJ2aWV3JyBhcyBjb25zdFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gSW52ZW50b3J5QW5hbHlzaXNTY2hlbWEucGFyc2UodmFsaWRJbnB1dCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc2VsbGVyQ291bnRUaW1lZnJhbWUpLnRvQmUoJzkwZGF5Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRhcmdldFR1cm5vdmVyUmF0ZSkudG9CZSgxMik7IC8vIERlZmF1bHRcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWNjZXB0IGN1c3RvbSBwYXJhbWV0ZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5wdXQgPSB7XG4gICAgICAgIGRvbWFpbjogMSxcbiAgICAgICAgY2F0ZWdvcnlJZDogNDkzOTY0LFxuICAgICAgICBhbmFseXNpc1R5cGU6ICdmYXN0X21vdmVycycgYXMgY29uc3QsXG4gICAgICAgIHNlbGxlckNvdW50VGltZWZyYW1lOiAnMTgwZGF5JyBhcyBjb25zdCxcbiAgICAgICAgdGFyZ2V0VHVybm92ZXJSYXRlOiAyNCxcbiAgICAgICAgdGltZWZyYW1lOiAncXVhcnRlcicgYXMgY29uc3RcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IEludmVudG9yeUFuYWx5c2lzU2NoZW1hLnBhcnNlKGlucHV0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zZWxsZXJDb3VudFRpbWVmcmFtZSkudG9CZSgnMTgwZGF5Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRhcmdldFR1cm5vdmVyUmF0ZSkudG9CZSgyNCk7XG4gICAgICBleHBlY3QocmVzdWx0LnRpbWVmcmFtZSkudG9CZSgncXVhcnRlcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2NoZW1hIEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZW5zdXJlIGFsbCBzY2hlbWFzIGhhdmUgY29uc2lzdGVudCBzZWxsZXJDb3VudFRpbWVmcmFtZSBvcHRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXhwZWN0ZWRPcHRpb25zID0gWydjdXJyZW50JywgJzMwZGF5JywgJzkwZGF5JywgJzE4MGRheScsICczNjVkYXknXTtcbiAgICAgIFxuICAgICAgLy8gVGVzdCB0aGF0IGFsbCBzY2hlbWFzIGFjY2VwdCB0aGUgc2FtZSB0aW1lZnJhbWUgb3B0aW9uc1xuICAgICAgZXhwZWN0ZWRPcHRpb25zLmZvckVhY2godGltZWZyYW1lID0+IHtcbiAgICAgICAgZXhwZWN0KCgpID0+IFByb2R1Y3RGaW5kZXJTY2hlbWEucGFyc2UoeyBcbiAgICAgICAgICBkb21haW46IDEsIFxuICAgICAgICAgIHNlbGxlckNvdW50VGltZWZyYW1lOiB0aW1lZnJhbWUgXG4gICAgICAgIH0pKS5ub3QudG9UaHJvdygpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KCgpID0+IENhdGVnb3J5QW5hbHlzaXNTY2hlbWEucGFyc2UoeyBcbiAgICAgICAgICBkb21haW46IDEsIFxuICAgICAgICAgIGNhdGVnb3J5SWQ6IDEyMywgXG4gICAgICAgICAgc2VsbGVyQ291bnRUaW1lZnJhbWU6IHRpbWVmcmFtZSBcbiAgICAgICAgfSkpLm5vdC50b1Rocm93KCk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QoKCkgPT4gU2FsZXNWZWxvY2l0eVNjaGVtYS5wYXJzZSh7IFxuICAgICAgICAgIGRvbWFpbjogMSwgXG4gICAgICAgICAgc2VsbGVyQ291bnRUaW1lZnJhbWU6IHRpbWVmcmFtZSBcbiAgICAgICAgfSkpLm5vdC50b1Rocm93KCk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QoKCkgPT4gSW52ZW50b3J5QW5hbHlzaXNTY2hlbWEucGFyc2UoeyBcbiAgICAgICAgICBkb21haW46IDEsIFxuICAgICAgICAgIHNlbGxlckNvdW50VGltZWZyYW1lOiB0aW1lZnJhbWUgXG4gICAgICAgIH0pKS5ub3QudG9UaHJvdygpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIHRpbWVmcmFtZXMgY29uc2lzdGVudGx5IGFjcm9zcyBhbGwgc2NoZW1hcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRUaW1lZnJhbWUgPSAnd2Vla2x5JztcbiAgICAgIFxuICAgICAgZXhwZWN0KCgpID0+IFByb2R1Y3RGaW5kZXJTY2hlbWEucGFyc2UoeyBcbiAgICAgICAgZG9tYWluOiAxLCBcbiAgICAgICAgc2VsbGVyQ291bnRUaW1lZnJhbWU6IGludmFsaWRUaW1lZnJhbWUgXG4gICAgICB9KSkudG9UaHJvdygpO1xuICAgICAgXG4gICAgICBleHBlY3QoKCkgPT4gQ2F0ZWdvcnlBbmFseXNpc1NjaGVtYS5wYXJzZSh7IFxuICAgICAgICBkb21haW46IDEsIFxuICAgICAgICBjYXRlZ29yeUlkOiAxMjMsIFxuICAgICAgICBzZWxsZXJDb3VudFRpbWVmcmFtZTogaW52YWxpZFRpbWVmcmFtZSBcbiAgICAgIH0pKS50b1Rocm93KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCgoKSA9PiBTYWxlc1ZlbG9jaXR5U2NoZW1hLnBhcnNlKHsgXG4gICAgICAgIGRvbWFpbjogMSwgXG4gICAgICAgIHNlbGxlckNvdW50VGltZWZyYW1lOiBpbnZhbGlkVGltZWZyYW1lIFxuICAgICAgfSkpLnRvVGhyb3coKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KCgpID0+IEludmVudG9yeUFuYWx5c2lzU2NoZW1hLnBhcnNlKHsgXG4gICAgICAgIGRvbWFpbjogMSwgXG4gICAgICAgIHNlbGxlckNvdW50VGltZWZyYW1lOiBpbnZhbGlkVGltZWZyYW1lIFxuICAgICAgfSkpLnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXX0=