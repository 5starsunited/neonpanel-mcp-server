"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = __importDefault(require("express"));
const cors_1 = __importDefault(require("cors"));
const keepa_client_1 = require("./keepa-client");
const tools_1 = require("./tools");
const app = (0, express_1.default)();
// Middleware
app.use((0, cors_1.default)());
app.use(express_1.default.json());
// Error handling middleware
const asyncHandler = (fn) => (req, res, next) => {
    Promise.resolve(fn(req, res, next)).catch(next);
};
// Health check endpoint
app.get('/health', (req, res) => {
    res.json({ status: 'healthy', timestamp: new Date().toISOString() });
});
// Keepa API endpoints - user provides API key in request body
app.post('/api/keepa/product-lookup', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.lookupProduct(tools_1.ProductLookupSchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/batch-product-lookup', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.batchLookupProducts(tools_1.BatchProductLookupSchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/search-deals', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.searchDeals(tools_1.DealSearchSchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/seller-lookup', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.lookupSeller(tools_1.SellerLookupSchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/best-sellers', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.getBestSellers(tools_1.BestSellersSchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/price-history', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.getPriceHistory(tools_1.PriceHistorySchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/product-finder', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.findProducts(tools_1.ProductFinderSchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/category-analysis', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.analyzeCategory(tools_1.CategoryAnalysisSchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/sales-velocity', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.analyzeSalesVelocity(tools_1.SalesVelocitySchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/inventory-analysis', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.analyzeInventory(tools_1.InventoryAnalysisSchema.parse(params));
    res.json({ result });
}));
app.post('/api/keepa/token-status', asyncHandler(async (req, res) => {
    const { apiKey, ...params } = req.body;
    if (!apiKey) {
        return res.status(400).json({ error: 'apiKey is required in request body' });
    }
    const keepaClient = new keepa_client_1.KeepaClient({ apiKey });
    const keepaTools = new tools_1.KeepaTools(keepaClient);
    const result = await keepaTools.getTokenStatus(tools_1.TokenStatusSchema.parse(params));
    res.json({ result });
}));
// Keepa webhook endpoint for notifications
app.post('/api/keepa/webhook', asyncHandler(async (req, res) => {
    const notification = req.body;
    console.log('ðŸ“© Received Keepa webhook notification:', {
        timestamp: new Date().toISOString(),
        type: notification.notificationType || 'unknown',
        payload: notification
    });
    // Process different types of notifications
    switch (notification.notificationType) {
        case 'PRODUCT_PRICE_CHANGE':
            console.log('ï¿½ï¿½ Price change notification for ASIN:', notification.asin);
            break;
        case 'PRODUCT_AVAILABILITY_CHANGE':
            console.log('ðŸ“¦ Availability change notification for ASIN:', notification.asin);
            break;
        case 'DEAL_NOTIFICATION':
            console.log('ðŸŽ¯ Deal notification:', notification);
            break;
        default:
            console.log('ðŸ“¨ Generic notification:', notification);
    }
    // Respond with 200 OK to acknowledge receipt
    res.status(200).json({
        status: 'received',
        timestamp: new Date().toISOString(),
        message: 'Webhook notification processed successfully'
    });
}));
// Webhook verification endpoint (for Keepa to verify the endpoint)
app.get('/api/keepa/webhook', (req, res) => {
    res.json({
        status: 'active',
        endpoint: 'Keepa webhook endpoint',
        timestamp: new Date().toISOString(),
        message: 'This endpoint is ready to receive Keepa notifications'
    });
});
// Error handling middleware
app.use((error, req, res, next) => {
    console.error('Error:', error);
    const statusCode = error.statusCode || 500;
    const message = error.message || 'Internal server error';
    res.status(statusCode).json({
        error: message,
        timestamp: new Date().toISOString()
    });
});
// 404 handler
app.use((req, res) => {
    res.status(404).json({
        error: 'Not found',
        path: req.path,
        timestamp: new Date().toISOString()
    });
});
const PORT = process.env.PORT || 3000;
if (require.main === module) {
    app.listen(PORT, () => {
        console.log(`Keepa Express server running on port ${PORT}`);
        console.log(`Health check: http://localhost:${PORT}/health`);
        console.log('Available endpoints:');
        console.log('  POST /api/keepa/product-lookup');
        console.log('  POST /api/keepa/batch-product-lookup');
        console.log('  POST /api/keepa/search-deals');
        console.log('  POST /api/keepa/seller-lookup');
        console.log('  POST /api/keepa/best-sellers');
        console.log('  POST /api/keepa/price-history');
        console.log('  POST /api/keepa/product-finder');
        console.log('  POST /api/keepa/category-analysis');
        console.log('  POST /api/keepa/sales-velocity');
        console.log('  POST /api/keepa/inventory-analysis');
        console.log('  POST /api/keepa/token-status');
        console.log('  POST /api/keepa/webhook (for Keepa notifications)');
        console.log('  GET  /api/keepa/webhook (webhook verification)');
        console.log('');
        console.log('Note: All endpoints require "apiKey" in the request body');
    });
}
exports.default = app;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsc0RBQThCO0FBQzlCLGdEQUF3QjtBQUN4QixpREFBNkM7QUFDN0MsbUNBYWlCO0FBRWpCLE1BQU0sR0FBRyxHQUFHLElBQUEsaUJBQU8sR0FBRSxDQUFDO0FBRXRCLGFBQWE7QUFDYixHQUFHLENBQUMsR0FBRyxDQUFDLElBQUEsY0FBSSxHQUFFLENBQUMsQ0FBQztBQUNoQixHQUFHLENBQUMsR0FBRyxDQUFDLGlCQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUV4Qiw0QkFBNEI7QUFDNUIsTUFBTSxZQUFZLEdBQUcsQ0FBQyxFQUFZLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBb0IsRUFBRSxHQUFxQixFQUFFLElBQTBCLEVBQUUsRUFBRTtJQUNqSCxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2xELENBQUMsQ0FBQztBQUVGLHdCQUF3QjtBQUN4QixHQUFHLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDLEdBQW9CLEVBQUUsR0FBcUIsRUFBRSxFQUFFO0lBQ2pFLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUN2RSxDQUFDLENBQUMsQ0FBQztBQUVILDhEQUE4RDtBQUM5RCxHQUFHLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFLFlBQVksQ0FBQyxLQUFLLEVBQUUsR0FBb0IsRUFBRSxHQUFxQixFQUFFLEVBQUU7SUFDdkcsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDdkMsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUNYLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsb0NBQW9DLEVBQUUsQ0FBQyxDQUFDO0tBQzlFO0lBRUQsTUFBTSxXQUFXLEdBQUcsSUFBSSwwQkFBVyxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUNoRCxNQUFNLFVBQVUsR0FBRyxJQUFJLGtCQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFL0MsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsYUFBYSxDQUFDLDJCQUFtQixDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZCLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFSixHQUFHLENBQUMsSUFBSSxDQUFDLGlDQUFpQyxFQUFFLFlBQVksQ0FBQyxLQUFLLEVBQUUsR0FBb0IsRUFBRSxHQUFxQixFQUFFLEVBQUU7SUFDN0csTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDdkMsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUNYLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsb0NBQW9DLEVBQUUsQ0FBQyxDQUFDO0tBQzlFO0lBRUQsTUFBTSxXQUFXLEdBQUcsSUFBSSwwQkFBVyxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUNoRCxNQUFNLFVBQVUsR0FBRyxJQUFJLGtCQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFL0MsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsbUJBQW1CLENBQUMsZ0NBQXdCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDNUYsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLEdBQUcsQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFvQixFQUFFLEdBQXFCLEVBQUUsRUFBRTtJQUNyRyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUM7S0FDOUU7SUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUUvQyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxXQUFXLENBQUMsd0JBQWdCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDNUUsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLEdBQUcsQ0FBQyxJQUFJLENBQUMsMEJBQTBCLEVBQUUsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFvQixFQUFFLEdBQXFCLEVBQUUsRUFBRTtJQUN0RyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUM7S0FDOUU7SUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUUvQyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxZQUFZLENBQUMsMEJBQWtCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDL0UsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLEdBQUcsQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFvQixFQUFFLEdBQXFCLEVBQUUsRUFBRTtJQUNyRyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUM7S0FDOUU7SUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUUvQyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxjQUFjLENBQUMseUJBQWlCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDaEYsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLEdBQUcsQ0FBQyxJQUFJLENBQUMsMEJBQTBCLEVBQUUsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFvQixFQUFFLEdBQXFCLEVBQUUsRUFBRTtJQUN0RyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUM7S0FDOUU7SUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUUvQyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxlQUFlLENBQUMsMEJBQWtCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDbEYsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLEdBQUcsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUUsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFvQixFQUFFLEdBQXFCLEVBQUUsRUFBRTtJQUN2RyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUM7S0FDOUU7SUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUUvQyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxZQUFZLENBQUMsMkJBQW1CLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDaEYsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLEdBQUcsQ0FBQyxJQUFJLENBQUMsOEJBQThCLEVBQUUsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFvQixFQUFFLEdBQXFCLEVBQUUsRUFBRTtJQUMxRyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUM7S0FDOUU7SUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUUvQyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxlQUFlLENBQUMsOEJBQXNCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDdEYsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLEdBQUcsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUUsWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFvQixFQUFFLEdBQXFCLEVBQUUsRUFBRTtJQUN2RyxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztJQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFO1FBQ1gsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUM7S0FDOUU7SUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUUvQyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQywyQkFBbUIsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN4RixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztBQUN2QixDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRUosR0FBRyxDQUFDLElBQUksQ0FBQywrQkFBK0IsRUFBRSxZQUFZLENBQUMsS0FBSyxFQUFFLEdBQW9CLEVBQUUsR0FBcUIsRUFBRSxFQUFFO0lBQzNHLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO0lBQ3ZDLElBQUksQ0FBQyxNQUFNLEVBQUU7UUFDWCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLG9DQUFvQyxFQUFFLENBQUMsQ0FBQztLQUM5RTtJQUVELE1BQU0sV0FBVyxHQUFHLElBQUksMEJBQVcsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDaEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxrQkFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBRS9DLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLGdCQUFnQixDQUFDLCtCQUF1QixDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ3hGLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZCLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFSixHQUFHLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLFlBQVksQ0FBQyxLQUFLLEVBQUUsR0FBb0IsRUFBRSxHQUFxQixFQUFFLEVBQUU7SUFDckcsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFDdkMsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUNYLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsb0NBQW9DLEVBQUUsQ0FBQyxDQUFDO0tBQzlFO0lBRUQsTUFBTSxXQUFXLEdBQUcsSUFBSSwwQkFBVyxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUNoRCxNQUFNLFVBQVUsR0FBRyxJQUFJLGtCQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFL0MsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsY0FBYyxDQUFDLHlCQUFpQixDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ2hGLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZCLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFSiwyQ0FBMkM7QUFDM0MsR0FBRyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxZQUFZLENBQUMsS0FBSyxFQUFFLEdBQW9CLEVBQUUsR0FBcUIsRUFBRSxFQUFFO0lBQ2hHLE1BQU0sWUFBWSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7SUFFOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsRUFBRTtRQUNyRCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7UUFDbkMsSUFBSSxFQUFFLFlBQVksQ0FBQyxnQkFBZ0IsSUFBSSxTQUFTO1FBQ2hELE9BQU8sRUFBRSxZQUFZO0tBQ3RCLENBQUMsQ0FBQztJQUVILDJDQUEyQztJQUMzQyxRQUFRLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRTtRQUNyQyxLQUFLLHNCQUFzQjtZQUN6QixPQUFPLENBQUMsR0FBRyxDQUFDLHdDQUF3QyxFQUFFLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6RSxNQUFNO1FBQ1IsS0FBSyw2QkFBNkI7WUFDaEMsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQ0FBK0MsRUFBRSxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDaEYsTUFBTTtRQUNSLEtBQUssbUJBQW1CO1lBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEVBQUUsWUFBWSxDQUFDLENBQUM7WUFDbkQsTUFBTTtRQUNSO1lBQ0UsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsRUFBRSxZQUFZLENBQUMsQ0FBQztLQUN6RDtJQUVELDZDQUE2QztJQUM3QyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNuQixNQUFNLEVBQUUsVUFBVTtRQUNsQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7UUFDbkMsT0FBTyxFQUFFLDZDQUE2QztLQUN2RCxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRUosbUVBQW1FO0FBQ25FLEdBQUcsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxHQUFvQixFQUFFLEdBQXFCLEVBQUUsRUFBRTtJQUM1RSxHQUFHLENBQUMsSUFBSSxDQUFDO1FBQ1AsTUFBTSxFQUFFLFFBQVE7UUFDaEIsUUFBUSxFQUFFLHdCQUF3QjtRQUNsQyxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7UUFDbkMsT0FBTyxFQUFFLHVEQUF1RDtLQUNqRSxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILDRCQUE0QjtBQUM1QixHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBVSxFQUFFLEdBQW9CLEVBQUUsR0FBcUIsRUFBRSxJQUEwQixFQUFFLEVBQUU7SUFDOUYsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFL0IsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLFVBQVUsSUFBSSxHQUFHLENBQUM7SUFDM0MsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sSUFBSSx1QkFBdUIsQ0FBQztJQUV6RCxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUMxQixLQUFLLEVBQUUsT0FBTztRQUNkLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtLQUNwQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILGNBQWM7QUFDZCxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBb0IsRUFBRSxHQUFxQixFQUFFLEVBQUU7SUFDdEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDbkIsS0FBSyxFQUFFLFdBQVc7UUFDbEIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJO1FBQ2QsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO0tBQ3BDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDO0FBQ3RDLElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxNQUFNLEVBQUU7SUFDM0IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFO1FBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0NBQXdDLElBQUksRUFBRSxDQUFDLENBQUM7UUFDNUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsSUFBSSxTQUFTLENBQUMsQ0FBQztRQUM3RCxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsd0NBQXdDLENBQUMsQ0FBQztRQUN0RCxPQUFPLENBQUMsR0FBRyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7UUFDOUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztRQUM5QyxPQUFPLENBQUMsR0FBRyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7UUFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMscUNBQXFDLENBQUMsQ0FBQztRQUNuRCxPQUFPLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFDaEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1FBQ3BELE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztRQUM5QyxPQUFPLENBQUMsR0FBRyxDQUFDLHFEQUFxRCxDQUFDLENBQUM7UUFDbkUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1FBQ2hFLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEIsT0FBTyxDQUFDLEdBQUcsQ0FBQywwREFBMEQsQ0FBQyxDQUFDO0lBQzFFLENBQUMsQ0FBQyxDQUFDO0NBQ0o7QUFFRCxrQkFBZSxHQUFHLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBjb3JzIGZyb20gJ2NvcnMnO1xuaW1wb3J0IHsgS2VlcGFDbGllbnQgfSBmcm9tICcuL2tlZXBhLWNsaWVudCc7XG5pbXBvcnQgeyBcbiAgS2VlcGFUb29scyxcbiAgUHJvZHVjdExvb2t1cFNjaGVtYSxcbiAgQmF0Y2hQcm9kdWN0TG9va3VwU2NoZW1hLFxuICBEZWFsU2VhcmNoU2NoZW1hLFxuICBTZWxsZXJMb29rdXBTY2hlbWEsXG4gIEJlc3RTZWxsZXJzU2NoZW1hLFxuICBQcmljZUhpc3RvcnlTY2hlbWEsXG4gIFByb2R1Y3RGaW5kZXJTY2hlbWEsXG4gIENhdGVnb3J5QW5hbHlzaXNTY2hlbWEsXG4gIFNhbGVzVmVsb2NpdHlTY2hlbWEsXG4gIEludmVudG9yeUFuYWx5c2lzU2NoZW1hLFxuICBUb2tlblN0YXR1c1NjaGVtYSxcbn0gZnJvbSAnLi90b29scyc7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcblxuLy8gTWlkZGxld2FyZVxuYXBwLnVzZShjb3JzKCkpO1xuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5cbi8vIEVycm9yIGhhbmRsaW5nIG1pZGRsZXdhcmVcbmNvbnN0IGFzeW5jSGFuZGxlciA9IChmbjogRnVuY3Rpb24pID0+IChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBleHByZXNzLk5leHRGdW5jdGlvbikgPT4ge1xuICBQcm9taXNlLnJlc29sdmUoZm4ocmVxLCByZXMsIG5leHQpKS5jYXRjaChuZXh0KTtcbn07XG5cbi8vIEhlYWx0aCBjaGVjayBlbmRwb2ludFxuYXBwLmdldCgnL2hlYWx0aCcsIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG4gIHJlcy5qc29uKHsgc3RhdHVzOiAnaGVhbHRoeScsIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pO1xufSk7XG5cbi8vIEtlZXBhIEFQSSBlbmRwb2ludHMgLSB1c2VyIHByb3ZpZGVzIEFQSSBrZXkgaW4gcmVxdWVzdCBib2R5XG5hcHAucG9zdCgnL2FwaS9rZWVwYS9wcm9kdWN0LWxvb2t1cCcsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuICBjb25zdCB7IGFwaUtleSwgLi4ucGFyYW1zIH0gPSByZXEuYm9keTtcbiAgaWYgKCFhcGlLZXkpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ2FwaUtleSBpcyByZXF1aXJlZCBpbiByZXF1ZXN0IGJvZHknIH0pO1xuICB9XG4gIFxuICBjb25zdCBrZWVwYUNsaWVudCA9IG5ldyBLZWVwYUNsaWVudCh7IGFwaUtleSB9KTtcbiAgY29uc3Qga2VlcGFUb29scyA9IG5ldyBLZWVwYVRvb2xzKGtlZXBhQ2xpZW50KTtcbiAgXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGtlZXBhVG9vbHMubG9va3VwUHJvZHVjdChQcm9kdWN0TG9va3VwU2NoZW1hLnBhcnNlKHBhcmFtcykpO1xuICByZXMuanNvbih7IHJlc3VsdCB9KTtcbn0pKTtcblxuYXBwLnBvc3QoJy9hcGkva2VlcGEvYmF0Y2gtcHJvZHVjdC1sb29rdXAnLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgeyBhcGlLZXksIC4uLnBhcmFtcyB9ID0gcmVxLmJvZHk7XG4gIGlmICghYXBpS2V5KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdhcGlLZXkgaXMgcmVxdWlyZWQgaW4gcmVxdWVzdCBib2R5JyB9KTtcbiAgfVxuICBcbiAgY29uc3Qga2VlcGFDbGllbnQgPSBuZXcgS2VlcGFDbGllbnQoeyBhcGlLZXkgfSk7XG4gIGNvbnN0IGtlZXBhVG9vbHMgPSBuZXcgS2VlcGFUb29scyhrZWVwYUNsaWVudCk7XG4gIFxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZWVwYVRvb2xzLmJhdGNoTG9va3VwUHJvZHVjdHMoQmF0Y2hQcm9kdWN0TG9va3VwU2NoZW1hLnBhcnNlKHBhcmFtcykpO1xuICByZXMuanNvbih7IHJlc3VsdCB9KTtcbn0pKTtcblxuYXBwLnBvc3QoJy9hcGkva2VlcGEvc2VhcmNoLWRlYWxzJywgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG4gIGNvbnN0IHsgYXBpS2V5LCAuLi5wYXJhbXMgfSA9IHJlcS5ib2R5O1xuICBpZiAoIWFwaUtleSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnYXBpS2V5IGlzIHJlcXVpcmVkIGluIHJlcXVlc3QgYm9keScgfSk7XG4gIH1cbiAgXG4gIGNvbnN0IGtlZXBhQ2xpZW50ID0gbmV3IEtlZXBhQ2xpZW50KHsgYXBpS2V5IH0pO1xuICBjb25zdCBrZWVwYVRvb2xzID0gbmV3IEtlZXBhVG9vbHMoa2VlcGFDbGllbnQpO1xuICBcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQga2VlcGFUb29scy5zZWFyY2hEZWFscyhEZWFsU2VhcmNoU2NoZW1hLnBhcnNlKHBhcmFtcykpO1xuICByZXMuanNvbih7IHJlc3VsdCB9KTtcbn0pKTtcblxuYXBwLnBvc3QoJy9hcGkva2VlcGEvc2VsbGVyLWxvb2t1cCcsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuICBjb25zdCB7IGFwaUtleSwgLi4ucGFyYW1zIH0gPSByZXEuYm9keTtcbiAgaWYgKCFhcGlLZXkpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ2FwaUtleSBpcyByZXF1aXJlZCBpbiByZXF1ZXN0IGJvZHknIH0pO1xuICB9XG4gIFxuICBjb25zdCBrZWVwYUNsaWVudCA9IG5ldyBLZWVwYUNsaWVudCh7IGFwaUtleSB9KTtcbiAgY29uc3Qga2VlcGFUb29scyA9IG5ldyBLZWVwYVRvb2xzKGtlZXBhQ2xpZW50KTtcbiAgXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGtlZXBhVG9vbHMubG9va3VwU2VsbGVyKFNlbGxlckxvb2t1cFNjaGVtYS5wYXJzZShwYXJhbXMpKTtcbiAgcmVzLmpzb24oeyByZXN1bHQgfSk7XG59KSk7XG5cbmFwcC5wb3N0KCcvYXBpL2tlZXBhL2Jlc3Qtc2VsbGVycycsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuICBjb25zdCB7IGFwaUtleSwgLi4ucGFyYW1zIH0gPSByZXEuYm9keTtcbiAgaWYgKCFhcGlLZXkpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ2FwaUtleSBpcyByZXF1aXJlZCBpbiByZXF1ZXN0IGJvZHknIH0pO1xuICB9XG4gIFxuICBjb25zdCBrZWVwYUNsaWVudCA9IG5ldyBLZWVwYUNsaWVudCh7IGFwaUtleSB9KTtcbiAgY29uc3Qga2VlcGFUb29scyA9IG5ldyBLZWVwYVRvb2xzKGtlZXBhQ2xpZW50KTtcbiAgXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGtlZXBhVG9vbHMuZ2V0QmVzdFNlbGxlcnMoQmVzdFNlbGxlcnNTY2hlbWEucGFyc2UocGFyYW1zKSk7XG4gIHJlcy5qc29uKHsgcmVzdWx0IH0pO1xufSkpO1xuXG5hcHAucG9zdCgnL2FwaS9rZWVwYS9wcmljZS1oaXN0b3J5JywgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG4gIGNvbnN0IHsgYXBpS2V5LCAuLi5wYXJhbXMgfSA9IHJlcS5ib2R5O1xuICBpZiAoIWFwaUtleSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnYXBpS2V5IGlzIHJlcXVpcmVkIGluIHJlcXVlc3QgYm9keScgfSk7XG4gIH1cbiAgXG4gIGNvbnN0IGtlZXBhQ2xpZW50ID0gbmV3IEtlZXBhQ2xpZW50KHsgYXBpS2V5IH0pO1xuICBjb25zdCBrZWVwYVRvb2xzID0gbmV3IEtlZXBhVG9vbHMoa2VlcGFDbGllbnQpO1xuICBcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQga2VlcGFUb29scy5nZXRQcmljZUhpc3RvcnkoUHJpY2VIaXN0b3J5U2NoZW1hLnBhcnNlKHBhcmFtcykpO1xuICByZXMuanNvbih7IHJlc3VsdCB9KTtcbn0pKTtcblxuYXBwLnBvc3QoJy9hcGkva2VlcGEvcHJvZHVjdC1maW5kZXInLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgeyBhcGlLZXksIC4uLnBhcmFtcyB9ID0gcmVxLmJvZHk7XG4gIGlmICghYXBpS2V5KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdhcGlLZXkgaXMgcmVxdWlyZWQgaW4gcmVxdWVzdCBib2R5JyB9KTtcbiAgfVxuICBcbiAgY29uc3Qga2VlcGFDbGllbnQgPSBuZXcgS2VlcGFDbGllbnQoeyBhcGlLZXkgfSk7XG4gIGNvbnN0IGtlZXBhVG9vbHMgPSBuZXcgS2VlcGFUb29scyhrZWVwYUNsaWVudCk7XG4gIFxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZWVwYVRvb2xzLmZpbmRQcm9kdWN0cyhQcm9kdWN0RmluZGVyU2NoZW1hLnBhcnNlKHBhcmFtcykpO1xuICByZXMuanNvbih7IHJlc3VsdCB9KTtcbn0pKTtcblxuYXBwLnBvc3QoJy9hcGkva2VlcGEvY2F0ZWdvcnktYW5hbHlzaXMnLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgeyBhcGlLZXksIC4uLnBhcmFtcyB9ID0gcmVxLmJvZHk7XG4gIGlmICghYXBpS2V5KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdhcGlLZXkgaXMgcmVxdWlyZWQgaW4gcmVxdWVzdCBib2R5JyB9KTtcbiAgfVxuICBcbiAgY29uc3Qga2VlcGFDbGllbnQgPSBuZXcgS2VlcGFDbGllbnQoeyBhcGlLZXkgfSk7XG4gIGNvbnN0IGtlZXBhVG9vbHMgPSBuZXcgS2VlcGFUb29scyhrZWVwYUNsaWVudCk7XG4gIFxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZWVwYVRvb2xzLmFuYWx5emVDYXRlZ29yeShDYXRlZ29yeUFuYWx5c2lzU2NoZW1hLnBhcnNlKHBhcmFtcykpO1xuICByZXMuanNvbih7IHJlc3VsdCB9KTtcbn0pKTtcblxuYXBwLnBvc3QoJy9hcGkva2VlcGEvc2FsZXMtdmVsb2NpdHknLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgeyBhcGlLZXksIC4uLnBhcmFtcyB9ID0gcmVxLmJvZHk7XG4gIGlmICghYXBpS2V5KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdhcGlLZXkgaXMgcmVxdWlyZWQgaW4gcmVxdWVzdCBib2R5JyB9KTtcbiAgfVxuICBcbiAgY29uc3Qga2VlcGFDbGllbnQgPSBuZXcgS2VlcGFDbGllbnQoeyBhcGlLZXkgfSk7XG4gIGNvbnN0IGtlZXBhVG9vbHMgPSBuZXcgS2VlcGFUb29scyhrZWVwYUNsaWVudCk7XG4gIFxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZWVwYVRvb2xzLmFuYWx5emVTYWxlc1ZlbG9jaXR5KFNhbGVzVmVsb2NpdHlTY2hlbWEucGFyc2UocGFyYW1zKSk7XG4gIHJlcy5qc29uKHsgcmVzdWx0IH0pO1xufSkpO1xuXG5hcHAucG9zdCgnL2FwaS9rZWVwYS9pbnZlbnRvcnktYW5hbHlzaXMnLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgeyBhcGlLZXksIC4uLnBhcmFtcyB9ID0gcmVxLmJvZHk7XG4gIGlmICghYXBpS2V5KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdhcGlLZXkgaXMgcmVxdWlyZWQgaW4gcmVxdWVzdCBib2R5JyB9KTtcbiAgfVxuICBcbiAgY29uc3Qga2VlcGFDbGllbnQgPSBuZXcgS2VlcGFDbGllbnQoeyBhcGlLZXkgfSk7XG4gIGNvbnN0IGtlZXBhVG9vbHMgPSBuZXcgS2VlcGFUb29scyhrZWVwYUNsaWVudCk7XG4gIFxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZWVwYVRvb2xzLmFuYWx5emVJbnZlbnRvcnkoSW52ZW50b3J5QW5hbHlzaXNTY2hlbWEucGFyc2UocGFyYW1zKSk7XG4gIHJlcy5qc29uKHsgcmVzdWx0IH0pO1xufSkpO1xuXG5hcHAucG9zdCgnL2FwaS9rZWVwYS90b2tlbi1zdGF0dXMnLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgeyBhcGlLZXksIC4uLnBhcmFtcyB9ID0gcmVxLmJvZHk7XG4gIGlmICghYXBpS2V5KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdhcGlLZXkgaXMgcmVxdWlyZWQgaW4gcmVxdWVzdCBib2R5JyB9KTtcbiAgfVxuICBcbiAgY29uc3Qga2VlcGFDbGllbnQgPSBuZXcgS2VlcGFDbGllbnQoeyBhcGlLZXkgfSk7XG4gIGNvbnN0IGtlZXBhVG9vbHMgPSBuZXcgS2VlcGFUb29scyhrZWVwYUNsaWVudCk7XG4gIFxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZWVwYVRvb2xzLmdldFRva2VuU3RhdHVzKFRva2VuU3RhdHVzU2NoZW1hLnBhcnNlKHBhcmFtcykpO1xuICByZXMuanNvbih7IHJlc3VsdCB9KTtcbn0pKTtcblxuLy8gS2VlcGEgd2ViaG9vayBlbmRwb2ludCBmb3Igbm90aWZpY2F0aW9uc1xuYXBwLnBvc3QoJy9hcGkva2VlcGEvd2ViaG9vaycsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuICBjb25zdCBub3RpZmljYXRpb24gPSByZXEuYm9keTtcbiAgXG4gIGNvbnNvbGUubG9nKCfwn5OpIFJlY2VpdmVkIEtlZXBhIHdlYmhvb2sgbm90aWZpY2F0aW9uOicsIHtcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB0eXBlOiBub3RpZmljYXRpb24ubm90aWZpY2F0aW9uVHlwZSB8fCAndW5rbm93bicsXG4gICAgcGF5bG9hZDogbm90aWZpY2F0aW9uXG4gIH0pO1xuICBcbiAgLy8gUHJvY2VzcyBkaWZmZXJlbnQgdHlwZXMgb2Ygbm90aWZpY2F0aW9uc1xuICBzd2l0Y2ggKG5vdGlmaWNhdGlvbi5ub3RpZmljYXRpb25UeXBlKSB7XG4gICAgY2FzZSAnUFJPRFVDVF9QUklDRV9DSEFOR0UnOlxuICAgICAgY29uc29sZS5sb2coJ++/ve+/vSBQcmljZSBjaGFuZ2Ugbm90aWZpY2F0aW9uIGZvciBBU0lOOicsIG5vdGlmaWNhdGlvbi5hc2luKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ1BST0RVQ1RfQVZBSUxBQklMSVRZX0NIQU5HRSc6XG4gICAgICBjb25zb2xlLmxvZygn8J+TpiBBdmFpbGFiaWxpdHkgY2hhbmdlIG5vdGlmaWNhdGlvbiBmb3IgQVNJTjonLCBub3RpZmljYXRpb24uYXNpbik7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdERUFMX05PVElGSUNBVElPTic6XG4gICAgICBjb25zb2xlLmxvZygn8J+OryBEZWFsIG5vdGlmaWNhdGlvbjonLCBub3RpZmljYXRpb24pO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OoIEdlbmVyaWMgbm90aWZpY2F0aW9uOicsIG5vdGlmaWNhdGlvbik7XG4gIH1cbiAgXG4gIC8vIFJlc3BvbmQgd2l0aCAyMDAgT0sgdG8gYWNrbm93bGVkZ2UgcmVjZWlwdFxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgc3RhdHVzOiAncmVjZWl2ZWQnLFxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIG1lc3NhZ2U6ICdXZWJob29rIG5vdGlmaWNhdGlvbiBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5J1xuICB9KTtcbn0pKTtcblxuLy8gV2ViaG9vayB2ZXJpZmljYXRpb24gZW5kcG9pbnQgKGZvciBLZWVwYSB0byB2ZXJpZnkgdGhlIGVuZHBvaW50KVxuYXBwLmdldCgnL2FwaS9rZWVwYS93ZWJob29rJywgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgcmVzLmpzb24oe1xuICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgZW5kcG9pbnQ6ICdLZWVwYSB3ZWJob29rIGVuZHBvaW50JyxcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICBtZXNzYWdlOiAnVGhpcyBlbmRwb2ludCBpcyByZWFkeSB0byByZWNlaXZlIEtlZXBhIG5vdGlmaWNhdGlvbnMnXG4gIH0pO1xufSk7XG5cbi8vIEVycm9yIGhhbmRsaW5nIG1pZGRsZXdhcmVcbmFwcC51c2UoKGVycm9yOiBhbnksIHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGV4cHJlc3MuTmV4dEZ1bmN0aW9uKSA9PiB7XG4gIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKTtcbiAgXG4gIGNvbnN0IHN0YXR1c0NvZGUgPSBlcnJvci5zdGF0dXNDb2RlIHx8IDUwMDtcbiAgY29uc3QgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2UgfHwgJ0ludGVybmFsIHNlcnZlciBlcnJvcic7XG4gIFxuICByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oe1xuICAgIGVycm9yOiBtZXNzYWdlLFxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gIH0pO1xufSk7XG5cbi8vIDQwNCBoYW5kbGVyXG5hcHAudXNlKChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG4gIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICBlcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgcGF0aDogcmVxLnBhdGgsXG4gICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgfSk7XG59KTtcblxuY29uc3QgUE9SVCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgMzAwMDtcbmlmIChyZXF1aXJlLm1haW4gPT09IG1vZHVsZSkge1xuICBhcHAubGlzdGVuKFBPUlQsICgpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgS2VlcGEgRXhwcmVzcyBzZXJ2ZXIgcnVubmluZyBvbiBwb3J0ICR7UE9SVH1gKTtcbiAgICBjb25zb2xlLmxvZyhgSGVhbHRoIGNoZWNrOiBodHRwOi8vbG9jYWxob3N0OiR7UE9SVH0vaGVhbHRoYCk7XG4gICAgY29uc29sZS5sb2coJ0F2YWlsYWJsZSBlbmRwb2ludHM6Jyk7XG4gICAgY29uc29sZS5sb2coJyAgUE9TVCAvYXBpL2tlZXBhL3Byb2R1Y3QtbG9va3VwJyk7XG4gICAgY29uc29sZS5sb2coJyAgUE9TVCAvYXBpL2tlZXBhL2JhdGNoLXByb2R1Y3QtbG9va3VwJyk7XG4gICAgY29uc29sZS5sb2coJyAgUE9TVCAvYXBpL2tlZXBhL3NlYXJjaC1kZWFscycpO1xuICAgIGNvbnNvbGUubG9nKCcgIFBPU1QgL2FwaS9rZWVwYS9zZWxsZXItbG9va3VwJyk7XG4gICAgY29uc29sZS5sb2coJyAgUE9TVCAvYXBpL2tlZXBhL2Jlc3Qtc2VsbGVycycpO1xuICAgIGNvbnNvbGUubG9nKCcgIFBPU1QgL2FwaS9rZWVwYS9wcmljZS1oaXN0b3J5Jyk7XG4gICAgY29uc29sZS5sb2coJyAgUE9TVCAvYXBpL2tlZXBhL3Byb2R1Y3QtZmluZGVyJyk7XG4gICAgY29uc29sZS5sb2coJyAgUE9TVCAvYXBpL2tlZXBhL2NhdGVnb3J5LWFuYWx5c2lzJyk7XG4gICAgY29uc29sZS5sb2coJyAgUE9TVCAvYXBpL2tlZXBhL3NhbGVzLXZlbG9jaXR5Jyk7XG4gICAgY29uc29sZS5sb2coJyAgUE9TVCAvYXBpL2tlZXBhL2ludmVudG9yeS1hbmFseXNpcycpO1xuICAgIGNvbnNvbGUubG9nKCcgIFBPU1QgL2FwaS9rZWVwYS90b2tlbi1zdGF0dXMnKTtcbiAgICBjb25zb2xlLmxvZygnICBQT1NUIC9hcGkva2VlcGEvd2ViaG9vayAoZm9yIEtlZXBhIG5vdGlmaWNhdGlvbnMpJyk7XG4gICAgY29uc29sZS5sb2coJyAgR0VUICAvYXBpL2tlZXBhL3dlYmhvb2sgKHdlYmhvb2sgdmVyaWZpY2F0aW9uKScpO1xuICAgIGNvbnNvbGUubG9nKCcnKTtcbiAgICBjb25zb2xlLmxvZygnTm90ZTogQWxsIGVuZHBvaW50cyByZXF1aXJlIFwiYXBpS2V5XCIgaW4gdGhlIHJlcXVlc3QgYm9keScpO1xuICB9KTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXBwO1xuIl19