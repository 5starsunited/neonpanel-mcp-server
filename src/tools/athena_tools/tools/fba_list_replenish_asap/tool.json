{
  "name": "amazon_supply_chain_fba_list_replenish_asap",
  "description": "DEPRECATED: use supply_chain_list_fba_replenishment_candidates (query envelope) instead.\n\nList items that need to be replenished to FBA ASAP based on projected stockout risk and inbound coverage.\n\nInputs are a flat JSON object (no query envelope).\n\nRecommended defaults (confirm with user):\n- planning_base: actively_sold_only\n- time_window.lookahead_days: 14\n- sales_velocity: current\n- use_seasonality: true\n- override_default: false (so table defaults are used)\n- days_between_shipments: 14 (aka reorder cadence)\n- stockout_threshold_days: 7\n- limit: 50\n\nCommon questions to ask the user:\n- Which marketplaces/countries should we include? (default: ALL)\n- Do you want actively sold only (default), all, or a targeted subset?\n- Should results be limited to a specific company_id (if you have multiple)?\n\nKnowledge base (methodology & definitions): https://help.neonpanel.com/en/articles/60\nInventory Planning report (UI): https://my.neonpanel.com/app/reports/forecasting/inventory-planning",
  "isConsequential": false,
  "inputSchema": {
    "type": "object",
    "properties": {
      "planning_base": {
        "type": "string",
        "enum": [
          "all",
          "targeted_only",
          "actively_sold_only",
          "planned_only"
        ],
        "default": "actively_sold_only",
        "description": "Which universe of SKUs/items to consider. Recommended default: actively_sold_only. Use targeted_only with target_* filters."
      },
      "target_skus": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Optional: restrict to specific SKUs. Recommended when planning_base=targeted_only."
      },
      "target_inventory_ids": {
        "type": "array",
        "items": {
          "type": "integer"
        },
        "description": "Optional: restrict to specific inventory IDs. Recommended when planning_base=targeted_only."
      },
      "target_asins": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Optional: restrict to specific ASINs. Recommended when planning_base=targeted_only."
      },
      "parent_asins": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Optional: restrict to specific parent ASINs. Recommended when planning_base=targeted_only."
      },
      "brand": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Optional brand filter (exact match as stored in snapshot)."
      },
      "product_family": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Optional product_family filter (exact match as stored in snapshot)."
      },
      "category": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Optional category filter (exact match as stored in snapshot)."
      },
      "marketplaces": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": [
            "US",
            "UK",
            "ALL"
          ]
        },
        "default": [
          "ALL"
        ],
        "description": "Marketplace filter. If you provide both ALL and specific marketplaces, ALL is ignored. If you set countries, countries takes precedence over marketplaces."
      },
      "countries": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Optional explicit country/country_code filter. Takes precedence over marketplaces when non-empty."
      },
      "company_id": {
        "type": "integer",
        "minimum": 1,
        "description": "Optional: restrict to a specific permitted company_id. If omitted, uses all permitted companies."
      },
      "time_window": {
        "type": "object",
        "properties": {
          "lookahead_days": {
            "type": "integer",
            "minimum": 1,
            "default": 14,
            "description": "How many days ahead to evaluate stockout risk. Recommended default: 14. Ask the user if they want a different horizon (e.g., 7/14/30)."
          },
          "as_of_date": {
            "type": "string",
            "format": "date",
            "description": "Optional. Evaluate as of a specific date (YYYY-MM-DD). If omitted, the latest available snapshot date is used."
          }
        },
        "description": "Time window settings. Ask the user to confirm lookahead_days and (optionally) as_of_date."
      },
      "sales_velocity": {
        "type": "string",
        "enum": [
          "current",
          "target",
          "planned"
        ],
        "default": "current",
        "description": "Which sales velocity to use for projections. Recommended default: current."
      },
      "use_seasonality": {
        "type": "boolean",
        "default": true,
        "description": "Whether to apply seasonality adjustments (if available in the snapshot). Recommended default: true."
      },
      "override_default": {
        "type": "boolean",
        "default": false,
        "description": "If true, use fba_lead_time_days_override and fba_safety_stock_days_override instead of table defaults."
      },
      "fba_lead_time_days_override": {
        "type": "integer",
        "minimum": 0,
        "default": 12,
        "description": "Only used when override_default=true. Lead time (days) to use for FBA replenishment planning. Recommended default: 12 (confirm with user)."
      },
      "fba_safety_stock_days_override": {
        "type": "integer",
        "minimum": 0,
        "default": 60,
        "description": "Only used when override_default=true. Safety stock buffer expressed in days of coverage. This is treated as a MINIMUM required buffer (higher = more conservative). Recommended default: 60 (confirm with user)."
      },
      "days_between_shipments": {
        "type": "integer",
        "minimum": 0,
        "default": 14,
        "description": "Reorder cadence (synonym: days_between_shipments). Used to ensure inventory stays covered until the next replenishment cycle. This is added to lead_time + safety_stock coverage when computing shipment_due_* and recommended_ship_units. Recommended default: 14 (confirm with user)."
      },
      "limit": {
        "type": "integer",
        "minimum": 1,
        "default": 50,
        "description": "Max number of rows to return. Recommended default: 50."
      },
      "stockout_threshold_days": {
        "type": "integer",
        "minimum": 0,
        "default": 7,
        "description": "Threshold (days to OOS) for classifying urgency. Recommended default: 7."
      },
      "active_sold_min_units_per_day": {
        "type": "number",
        "minimum": 0,
        "default": 1,
        "description": "Only affects planning_base=actively_sold_only. Minimum average daily units (30-day basis) required to include an item as 'actively sold'. Default 1 means ~1 unit/day. Example: 100 means only items selling ~100/day or more are considered actively sold."
      }
    },
    "required": [
      "planning_base"
    ]
  },
  "outputSchema": {
    "type": "object",
    "properties": {
      "items": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "company_id": {
              "type": "integer",
              "description": "Company id for the row (helps validate filtering and client-side rendering)."
            },
            "item_ref": {
              "type": "object",
              "description": "Canonical item reference. Include at least one identifier. Prefer to include item_icon_url in tool outputs to avoid extra requests.",
              "properties": {
                "inventory_id": {
                  "type": "integer"
                },
                "sku": {
                  "type": "string"
                },
                "asin": {
                  "type": "string"
                },
                "marketplace": {
                  "type": "string",
                  "enum": [
                    "US",
                    "UK"
                  ]
                },
                "item_name": {
                  "type": "string"
                },
                "item_icon_url": {
                  "type": "string",
                  "description": "Small icon/image URL for item; include in datasets when possible."
                }
              }
            },
            "presentation": {
              "type": "object",
              "description": "UI-agnostic presentation payload. Clients can render links/images consistently. Links specify which identifier they are derived from.",
              "properties": {
                "identity": {
                  "type": "object",
                  "properties": {
                    "sku": { "type": "string" },
                    "asin": { "type": "string" },
                    "inventory_id": { "type": "integer" },
                    "marketplace_code": { "type": "string" }
                  }
                },
                "media": {
                  "type": "object",
                  "properties": {
                    "primary_image": {
                      "type": "object",
                      "properties": {
                        "url": { "type": "string" },
                        "derived_from": { "type": "string", "enum": ["sku"] },
                        "source_field": { "type": "string" },
                        "sku": { "type": "string" }
                      },
                      "required": ["derived_from"]
                    }
                  },
                  "required": ["primary_image"]
                },
                "links": {
                  "type": "object",
                  "properties": {
                    "neonpanel_inventory": {
                      "type": "object",
                      "properties": {
                        "url": { "type": "string" },
                        "derived_from": { "type": "string", "enum": ["inventory_id"] },
                        "inventory_id": { "type": "integer" }
                      },
                      "required": ["derived_from"]
                    },
                    "amazon_storefront": {
                      "type": "object",
                      "properties": {
                        "url": { "type": "string" },
                        "derived_from": { "type": "string", "enum": ["asin"] },
                        "asin": { "type": "string" },
                        "marketplace_code": { "type": "string" }
                      },
                      "required": ["derived_from"]
                    }
                  },
                  "required": ["neonpanel_inventory", "amazon_storefront"]
                }
              },
              "required": ["identity", "media", "links"]
            },
            "sales_velocity": {
              "type": "number",
              "description": "Units/day used for planning and recommendations (based on the selected sales_velocity input)."
            },
            "fba_days_of_supply": {
              "type": "number",
              "description": "Computed days of supply at the selected sales velocity (fba_available / sales_velocity)."
            },
            "shipment_due_date": {
              "type": "string",
              "description": "Date the replenishment shipment is due (clamped to today if overdue). Based on CURRENT_DATE + shipment_due_in_days.",
              "format": "date"
            },
            "shipment_due_in_days": {
              "type": "number",
              "description": "Days until shipment is due. Negative means overdue. Computed as days_of_supply - (lead_time + safety_stock)."
            },
            "shipment_overdue_days": {
              "type": "number",
              "description": "Days overdue (>= 0). 0 means not overdue."
            },
            "days_overdue": {
              "type": "number",
              "description": "Synonym for shipment_overdue_days (>= 0)."
            },
            "fba_on_hand": {
              "type": "integer"
            },
            "fba_inbound": {
              "type": "integer"
            },
            "recommended_ship_units": {
              "type": "integer"
            },
            "recommended_by_amazon_replenishment_quantity": {
              "type": "integer",
              "description": "Raw recommendation from Amazon (snapshot field recommended_replenishment_qty), renamed for clarity. This is NOT the tool's computed recommendation." 
            },
            "priority": {
              "type": "string",
              "enum": [
                "low",
                "medium",
                "high",
                "critical"
              ],
              "default": "high"
            },
            "reason": {
              "type": "string"
            }
          },
          "required": [
            "item_ref",
            "shipment_due_date",
            "shipment_overdue_days",
            "recommended_ship_units",
            "priority"
          ]
        }
      }
    },
    "required": [
      "items"
    ]
  },
  "examples": [
    {
      "name": "Recommended defaults (broad)",
      "description": "Use recommended defaults and all marketplaces.",
      "input": {
        "planning_base": "actively_sold_only",
        "marketplaces": [
          "ALL"
        ],
        "time_window": {
          "lookahead_days": 14
        },
        "sales_velocity": "current",
        "use_seasonality": true,
        "override_default": false,
        "limit": 50,
        "stockout_threshold_days": 7
      }
    },
    {
      "name": "Targeted SKUs (US only)",
      "description": "Target a small SKU list and restrict to US.",
      "input": {
        "planning_base": "targeted_only",
        "target_skus": [
          "SKU-EXAMPLE-1",
          "SKU-EXAMPLE-2"
        ],
        "marketplaces": [
          "US"
        ],
        "time_window": {
          "lookahead_days": 14
        },
        "sales_velocity": "current",
        "use_seasonality": true,
        "override_default": false,
        "limit": 200,
        "stockout_threshold_days": 7
      }
    }
  ]
}
