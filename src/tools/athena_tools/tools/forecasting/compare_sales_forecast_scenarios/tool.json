{
  "name": "forecasting_compare_sales_forecast_scenarios",
  "description": "Deep-dive forecasting comparison for multiple items with optional aggregation. Supports selectors by inventory_ids, sku+country_code, parent_asin, or product_family (pick one). Compares forecast outputs across scenarios and/or forecast runs, can overlay actuals, and can return aggregates plus per-item breakdown. Read-only; no side effects.",
  "isConsequential": false,
  "inputSchema": {
    "type": "object",
    "properties": {
      "query": {
        "type": "object",
        "properties": {
          "filters": {
            "type": "object",
            "description": "Item selector and optional filters. Provide exactly one selector path: inventory_ids OR sku + country_code OR parent_asin OR product_family.",
            "properties": {
              "company": {
                "type": "string",
                "description": "Numeric company ID as string. Deprecated; use company_id (integer) instead. If both provided, company_id takes precedence."
              },
              "company_id": { "type": "integer", "minimum": 1 },

              "inventory_ids": {
                "type": "array",
                "items": { "type": "integer", "minimum": 1 },
                "minItems": 1,
                "maxItems": 10,
                "description": "Selector path 1: inventory_ids (up to 10)."
              },

              "sku": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1,
                "maxItems": 10,
                "description": "Selector path 2: sku array (up to 10). Requires country_code."
              },
              "marketplace": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1,
                "maxItems": 1,
                "description": "Deprecated alias for country_code."
              },
              "country_code": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1,
                "maxItems": 1,
                "description": "Required when using sku selector."
              },

              "parent_asin": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1,
                "maxItems": 10,
                "description": "Selector path 3: parent ASIN (up to 10)."
              },
              "product_family": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1,
                "maxItems": 5,
                "description": "Selector path 4: product family (up to 5)."
              },
              "asin": {
                "type": "array",
                "items": { "type": "string" },
                "maxItems": 5,
                "description": "Optional constraint filter."
              }
            },
            "additionalProperties": true
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 500,
            "default": 200,
            "description": "Max rows returned (each row = one period x scenario x run). If limit exceeded, most recent periods are prioritized."
          }
        },
        "required": ["filters"],
        "additionalProperties": true
      },

      "tool_specific": {
        "type": "object",
        "properties": {
          "compare": {
            "type": "object",
            "properties": {
              "mode": {
                "type": "string",
                "enum": ["scenarios", "runs", "scenarios_and_runs"],
                "default": "scenarios",
                "description": "Comparison axis selection."
              },

              "aggregate": {
                "type": "string",
                "enum": ["none", "parent_asin", "product_family", "all"],
                "default": "none",
                "description": "Aggregation mode: group totals by parent_asin, product_family, or both."
              },
              "include_breakdown": {
                "type": "boolean",
                "default": false,
                "description": "When aggregating, also return per-item detail rows."
              },

              "scenario_ids": {
                "type": "array",
                "items": { "type": "integer", "minimum": 1 },
                "description": "Optional: scenario id(s) to include. If scenario_ids are provided, scenario_uuids and scenario_names are ignored."
              },
              "scenario_uuids": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Optional: scenario uuid(s) to include (e.g., 'manual', 'baseline'). If scenario_ids not provided but scenario_uuids are, scenario_names are ignored."
              },
              "scenario_names": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Optional: scenario name(s) to include (exact match recommended). Used only if neither scenario_ids nor scenario_uuids are provided. If none of the three are provided, all available scenarios are included."
              },

              "run_selector": {
                "type": "object",
                "description": "Select which forecast runs (updated_at timestamps) to compare. Defaults to latest_n=3. Used in scenarios/scenarios_and_runs modes; ignored in runs mode (which always selects single scenario's runs).",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["latest_n", "date_range"],
                    "default": "latest_n"
                  },
                  "n": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 10,
                    "default": 3,
                    "description": "When type=latest_n: number of most recent runs to include."
                  },
                  "updated_at_from": {
                    "type": "string",
                    "format": "date-time",
                    "description": "When type=date_range: inclusive lower bound for updated_at."
                  },
                  "updated_at_to": {
                    "type": "string",
                    "format": "date-time",
                    "description": "When type=date_range: exclusive upper bound for updated_at."
                  }
                },
                "additionalProperties": false
              },

              "include_actuals": {
                "type": "boolean",
                "default": true,
                "description": "If true (default), include sales history actuals and align by period."
              },

              "period": {
                "type": "object",
                "description": "Optional period/window selection for the time series output. Periods must be in YYYY-MM format (e.g., 2025-01, 2026-12).",
                "properties": {
                  "start": { "type": "string", "description": "Start period inclusive (e.g., 2025-01). If omitted, all available past periods included." },
                  "end": { "type": "string", "description": "End period inclusive (e.g., 2026-12). If omitted, all available future periods included." }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": false
          }
        },
        "additionalProperties": false
      }
    },
    "required": ["query"],
    "additionalProperties": false
  },
  "outputSchema": {
    "type": "object",
    "properties": {
      "items": {
        "type": "array",
        "description": "Per-item detail rows when detail is requested (aggregate=none or include_breakdown=true).",
        "items": {
          "type": "object",
          "properties": {
            "item_ref": { "type": "object", "additionalProperties": true },
            "rows": { "type": "array", "items": { "type": "object", "additionalProperties": true } }
          },
          "additionalProperties": false
        }
      },
      "aggregates": {
        "type": "array",
        "description": "Aggregated rows when aggregate mode is enabled.",
        "items": {
          "type": "object",
          "properties": {
            "group": { "type": "object", "additionalProperties": true },
            "rows": { "type": "array", "items": { "type": "object", "additionalProperties": true } }
          },
          "additionalProperties": false
        }
      },
      "meta": {
        "type": "object",
        "properties": {
          "warnings": { "type": "array", "items": { "type": "string" } },
          "applied_compare": { "type": "object", "additionalProperties": true }
        },
        "additionalProperties": true
      }
    },
    "additionalProperties": true
  }
}
