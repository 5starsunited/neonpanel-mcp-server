{
  "name": "brand_analytics_get_keyword_funnel_metrics",
  "description": "Returns search funnel data (Impressions, Clicks, Cart Adds, Purchases) for keywords from Amazon Brand Analytics Search Query Performance (SQP) report.\n\nCompares 'Brand Share' against 'Total Market' to determine if the product is a conversion leader or needs SEO/PPC adjustments.\n\nUse this tool to:\n- Identify organic growth potential vs. conversion efficiency\n- Find keywords where you have high impressions but low click share (visibility gap)\n- Discover keywords where you have high clicks but low cart-add share (content/pricing issue)\n- Analyze conversion funnel drop-off points at each stage\n\nIMPORTANT: Results are capped by the 'limit' parameter (default 100). When 'keywords' is omitted, ALL keywords are considered but only the top N by sort order are returned. A company may have thousands of tracked keywords. To explore different keyword groups: (1) change sort field/direction to surface different keywords, (2) use keywords filter with match_type='contains' to drill into a keyword theme (e.g., ['ring'] returns all ring-related terms), or (3) use brand filters to narrow by product line.\n\nIntegration note: Cross-reference results with advertising_analyze_search_terms to compare organic funnel share vs paid PPC efficiency on the same keywords, or with brand_analytics_get_search_term_momentum to track click share trends over time.\n\nKnowledge base: https://help.neonpanel.com/en/articles/brand-analytics-sqp",
  "isConsequential": false,
  "inputSchema": {
    "type": "object",
    "properties": {
      "query": {
        "type": "object",
        "description": "Shared query envelope for Brand Analytics tools.",
        "properties": {
          "filters": {
            "type": "object",
            "description": "Standard filters for data selection.",
            "properties": {
              "company_id": {
                "type": "integer",
                "minimum": 1,
                "description": "Numeric company identifier. Required."
              },
              "keywords": {
                "type": "array",
                "items": { "type": "string" },
                "maxItems": 50,
                "description": "Optional: search terms to analyze. When omitted, ALL keywords are included (subject to 'limit'). Use with match_type='contains' to explore keyword themes (e.g., ['ring'] returns all ring-related terms). Combine multiple: ['ring', 'bracelet']."
              },
              "asin": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Optional: Filter to keywords where these ASINs appear in top 3 clicked products."
              },
              "brand": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Optional: Filter by brand name(s)."
              },
              "marketplace": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1,
                "maxItems": 1,
                "description": "Amazon marketplace code (e.g., 'US', 'UK', 'DE'). Single marketplace per query."
              },
              "product_family": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Optional: filter by product family name(s). Narrows results to keywords associated with specific product families."
              },
              "revenue_abcd_class": {
                "type": "array",
                "items": { "type": "string", "enum": ["A", "B", "C", "D"] },
                "description": "Optional: filter by revenue classification (A=top revenue, D=lowest)."
              },
              "pareto_abc_class": {
                "type": "array",
                "items": { "type": "string", "enum": ["A", "B", "C"] },
                "description": "Optional: filter by Pareto ABC classification (A=top 80% revenue, B=next 15%, C=bottom 5%)."
              }
            },
            "required": ["company_id", "marketplace"],
            "additionalProperties": false
          },
          "aggregation": {
            "type": "object",
            "description": "Time-based aggregation for funnel metrics.",
            "properties": {
              "time": {
                "type": "object",
                "properties": {
                  "periodicity": {
                    "type": "string",
                    "enum": ["week", "month", "quarter"],
                    "default": "week",
                    "description": "Aggregation period. Brand Analytics data is typically weekly."
                  },
                  "start_date": {
                    "type": "string",
                    "format": "date",
                    "description": "Start date for analysis window (inclusive)."
                  },
                  "end_date": {
                    "type": "string",
                    "format": "date",
                    "description": "End date for analysis window (inclusive). Defaults to most recent data."
                  },
                  "periods_back": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 52,
                    "default": 4,
                    "description": "Alternative to date range: number of periods to look back from most recent data."
                  }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": false
          },
          "sort": {
            "type": "object",
            "description": "Sort results by any output metric.",
            "properties": {
              "field": {
                "type": "string",
                "enum": [
                  "search_frequency_rank",
                  "total_impressions",
                  "brand_impression_share",
                  "total_clicks",
                  "brand_click_share",
                  "total_cart_adds",
                  "brand_cart_add_share",
                  "total_purchases",
                  "brand_purchase_share",
                  "brand_impression_to_click_rate",
                  "brand_click_to_cart_rate",
                  "brand_cart_to_purchase_rate",
                  "brand_impression_to_purchase_rate"
                ],
                "default": "search_frequency_rank",
                "description": "Column to sort and rank by. A 'rank' column (1-based) is added to the output. Default: search_frequency_rank ASC (highest volume first). Use total_impressions DESC for broadest reach, brand_purchase_share DESC for best conversion."
              },
              "direction": {
                "type": "string",
                "enum": ["asc", "desc"],
                "default": "asc",
                "description": "Sort direction. For search_frequency_rank use ASC (lower rank = higher volume). For most other metrics use DESC (higher = better)."
              }
            },
            "additionalProperties": false
          },
          "select_fields": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Optional output field selection. If omitted, returns all available metrics."
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 200,
            "default": 100,
            "description": "Maximum rows to return (default 100, max 200). Only the top N rows by the chosen sort order are returned. Use keywords filter to focus on specific keyword segments."
          }
        },
        "required": ["filters"],
        "additionalProperties": false
      },
      "tool_specific": {
        "type": "object",
        "description": "Brand Analytics keyword funnel specific parameters.",
        "properties": {
          "match_type": {
            "type": "string",
            "enum": ["exact", "contains", "starts_with"],
            "default": "contains",
            "description": "Keyword matching strategy for the keywords filter."
          },
          "include_trending": {
            "type": "boolean",
            "default": true,
            "description": "Include week-over-week trend calculations for each metric."
          },
          "min_search_frequency_rank": {
            "type": "integer",
            "minimum": 1,
            "description": "Filter out keywords with SFR worse (higher) than this value."
          },
          "min_impressions": {
            "type": "integer",
            "minimum": 0,
            "description": "Filter out keywords with fewer total impressions."
          },
          "funnel_analysis": {
            "type": "object",
            "description": "Configure funnel drop-off analysis thresholds.",
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": true,
                "description": "Calculate funnel stage drop-off metrics."
              },
              "benchmark_against": {
                "type": "string",
                "enum": ["market_average", "top_competitor", "historical_self"],
                "default": "market_average",
                "description": "Baseline for funnel performance comparison."
              }
            },
            "additionalProperties": false
          },
          "competitor_context": {
            "type": "boolean",
            "default": false,
            "description": "Include top 3 competitor ASINs and their shares for each keyword."
          }
        },
        "additionalProperties": false
      }
    },
    "required": ["query"],
    "additionalProperties": false
  },
  "outputSchema": {
    "type": "object",
    "properties": {
      "items": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "rank": { "type": "integer", "description": "1-based position by the chosen sort order" },
            "keyword": { "type": "string" },
            "marketplace": { "type": "string" },
            "period_start": { "type": "string", "format": "date" },
            "period_end": { "type": "string", "format": "date" },
            "search_frequency_rank": { "type": "integer", "description": "Amazon SFR (lower = higher search volume)" },
            "total_impressions": { "type": "integer", "description": "Total market impressions for this keyword" },
            "brand_impressions": { "type": "integer", "description": "Your brand's impressions for this keyword" },
            "brand_impression_share": { "type": "number", "description": "Your share of total impressions (0-1)" },
            "brand_impression_share_wow": { "type": ["number", "null"], "description": "Week-over-week change in impression share" },
            "total_clicks": { "type": "integer" },
            "brand_clicks": { "type": "integer" },
            "brand_click_share": { "type": "number", "description": "Your share of total clicks (0-1)" },
            "brand_click_share_wow": { "type": ["number", "null"] },
            "total_cart_adds": { "type": "integer" },
            "brand_cart_adds": { "type": "integer" },
            "brand_cart_add_share": { "type": "number", "description": "Your share of total cart adds (0-1)" },
            "brand_cart_add_share_wow": { "type": ["number", "null"] },
            "total_purchases": { "type": "integer" },
            "brand_purchases": { "type": "integer" },
            "brand_purchase_share": { "type": "number", "description": "Your share of total purchases (0-1)" },
            "brand_purchase_share_wow": { "type": ["number", "null"] },
            "market_impression_to_click_rate": { "type": ["number", "null"], "description": "Market-level click-through rate" },
            "market_click_to_cart_rate": { "type": ["number", "null"], "description": "Market-level add-to-cart rate" },
            "market_cart_to_purchase_rate": { "type": ["number", "null"], "description": "Market-level purchase conversion rate" },
            "market_impression_to_purchase_rate": { "type": ["number", "null"], "description": "Market-level end-to-end conversion" },
            "brand_impression_to_click_rate": { "type": ["number", "null"], "description": "Your brand's click-through rate" },
            "brand_click_to_cart_rate": { "type": ["number", "null"], "description": "Your brand's add-to-cart rate" },
            "brand_cart_to_purchase_rate": { "type": ["number", "null"], "description": "Your brand's purchase conversion rate" },
            "brand_impression_to_purchase_rate": { "type": ["number", "null"], "description": "Your brand's end-to-end conversion" }
          },
          "additionalProperties": true
        }
      },
      "meta": {
        "type": "object",
        "properties": {
          "total_keywords_analyzed": { "type": "integer" },
          "data_freshness": { "type": "string", "format": "date" },
          "applied_sort": { "type": "object" },
          "warnings": {
            "type": "array",
            "items": { "type": "string" }
          }
        },
        "additionalProperties": true
      }
    },
    "required": ["items"]
  }
}
